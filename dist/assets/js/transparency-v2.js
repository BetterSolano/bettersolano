const FINANCIAL_DATA={q1:{period:"Q1 2025",periodLabel:"Jan - Mar",income:{local:88.85,external:69.62,total:158.47},expenditures:{gps:42.76,social:13.33,economic:11.07,debt:.35,total:67.51},netIncome:90.96,fundBalance:283.29},q2:{period:"Q2 2025",periodLabel:"Apr - Jun",income:{local:114.15,external:139.25,total:253.4},expenditures:{gps:88.31,social:30.56,economic:20.32,debt:1.29,total:140.48},netIncome:112.92,fundBalance:275.2}};let incomeChart=null,expenditureChart=null,currentQuarter="q1";function formatPeso(e){return`₱${e.toFixed(2)} M`}function calcPercent(e,t){return(e/t*100).toFixed(1)+"%"}function animateValue(e,t){e.classList.add("updating"),setTimeout(()=>{e.textContent=t,e.classList.remove("updating")},150)}function updateDisplay(e){const t=FINANCIAL_DATA[e];animateValue(document.getElementById("sre-total-income"),formatPeso(t.income.total)),animateValue(document.getElementById("sre-total-expense"),formatPeso(t.expenditures.total)),animateValue(document.getElementById("sre-net-income"),formatPeso(t.netIncome)),animateValue(document.getElementById("sre-fund-balance"),formatPeso(t.fundBalance));const n=t.income.total;document.getElementById("sre-income-local").textContent=formatPeso(t.income.local),document.getElementById("sre-income-local-pct").textContent=calcPercent(t.income.local,n),document.getElementById("sre-income-external").textContent=formatPeso(t.income.external),document.getElementById("sre-income-external-pct").textContent=calcPercent(t.income.external,n);const o=t.expenditures.total;document.getElementById("sre-exp-gps").textContent=formatPeso(t.expenditures.gps),document.getElementById("sre-exp-gps-pct").textContent=calcPercent(t.expenditures.gps,o),document.getElementById("sre-exp-social").textContent=formatPeso(t.expenditures.social),document.getElementById("sre-exp-social-pct").textContent=calcPercent(t.expenditures.social,o),document.getElementById("sre-exp-economic").textContent=formatPeso(t.expenditures.economic),document.getElementById("sre-exp-economic-pct").textContent=calcPercent(t.expenditures.economic,o),document.getElementById("sre-exp-debt").textContent=formatPeso(t.expenditures.debt),document.getElementById("sre-exp-debt-pct").textContent=calcPercent(t.expenditures.debt,o),incomeChart&&(incomeChart.data.datasets[0].data=[t.income.local,t.income.external],incomeChart.update("active")),expenditureChart&&(expenditureChart.data.datasets[0].data=[t.expenditures.gps,t.expenditures.social,t.expenditures.economic,t.expenditures.debt],expenditureChart.update("active"))}function initCharts(){const e=document.getElementById("incomeChartV2"),t=document.getElementById("expenditureChartV2");if(!e||!t||"undefined"==typeof Chart)return;const n=FINANCIAL_DATA[currentQuarter],o={responsive:!0,maintainAspectRatio:!1,cutout:"65%",plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0,0,0,0.8)",padding:12,titleFont:{size:13,weight:"600"},bodyFont:{size:12},cornerRadius:8,callbacks:{label:function(e){return`₱${e.raw.toFixed(2)} M`}}}},animation:{animateRotate:!0,animateScale:!0,duration:600,easing:"easeOutQuart"}};incomeChart=new Chart(e,{type:"doughnut",data:{labels:["Local Sources","External Sources"],datasets:[{data:[n.income.local,n.income.external],backgroundColor:["#10b981","#0ea5e9"],borderWidth:0,hoverOffset:6}]},options:o}),expenditureChart=new Chart(t,{type:"doughnut",data:{labels:["General Public Services","Social Services","Economic Services","Debt Service"],datasets:[{data:[n.expenditures.gps,n.expenditures.social,n.expenditures.economic,n.expenditures.debt],backgroundColor:["#3b82f6","#8b5cf6","#f59e0b","#ef4444"],borderWidth:0,hoverOffset:6}]},options:o})}function initPeriodToggle(){const e=document.querySelectorAll(".sre-period-btn");e.forEach(t=>{t.addEventListener("click",function(){const t=this.dataset.quarter;t!==currentQuarter&&(e.forEach(e=>{e.classList.remove("active"),e.setAttribute("aria-selected","false")}),this.classList.add("active"),this.setAttribute("aria-selected","true"),currentQuarter=t,updateDisplay(t))})})}function initScrollAnimations(){if("undefined"==typeof IntersectionObserver)return void document.querySelectorAll(".animate-on-scroll").forEach(e=>{e.classList.add("visible")});const e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(t.target.classList.add("visible"),e.unobserve(t.target))})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".animate-on-scroll").forEach(t=>{e.observe(t)})}function initBreakdownInteractions(){document.querySelectorAll(".sre-breakdown-item").forEach(e=>{e.addEventListener("mouseenter",function(){highlightChartSegment(this.dataset.type,!0)}),e.addEventListener("mouseleave",function(){highlightChartSegment(this.dataset.type,!1)})})}function highlightChartSegment(e,t){const n=["local","external"],o=["gps","social","economic","debt"];let a=null,i=-1;if(n.includes(e)?(a=incomeChart,i=n.indexOf(e)):o.includes(e)&&(a=expenditureChart,i=o.indexOf(e)),a&&i>=0){const e=a.getDatasetMeta(0);e.data[i]&&(e.data[i].options.offset=t?8:0,a.update("none"))}}function init(){initPeriodToggle(),initCharts(),initScrollAnimations(),initBreakdownInteractions()}"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",init):init()),"undefined"!=typeof module&&module.exports&&(module.exports={FINANCIAL_DATA:FINANCIAL_DATA,formatPeso:formatPeso,calcPercent:calcPercent}),document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll(".dpwh-filter-btn"),t=document.querySelectorAll(".dpwh-table tbody tr");e.forEach(n=>{n.addEventListener("click",function(){const n=this.dataset.filter;e.forEach(e=>e.classList.remove("active")),this.classList.add("active"),t.forEach(e=>{"all"===n||e.dataset.category===n?e.style.display="":e.style.display="none"})})})});